[gd_scene load_steps=4 format=3 uid="uid://grenade001"]

[sub_resource type="GDScript" id="GDScript_1"]
script/source = "extends RigidBody3D

@export var explosion_damage := 75.0
@export var explosion_radius := 5.0
@export var fuse_time := 2.5

var fuse_timer := 0.0

func _ready():
	fuse_timer = fuse_time

func _physics_process(delta):
	fuse_timer -= delta
	if fuse_timer <= 0:
		explode()

func explode():
	# Find all bodies in explosion radius
	var space_state = get_world_3d().direct_space_state
	var bodies = get_tree().get_nodes_in_group(\"enemy\")
	bodies.append_array(get_tree().get_nodes_in_group(\"player\"))
	
	for body in bodies:
		if body == null or not is_instance_valid(body):
			continue
		var distance = global_position.distance_to(body.global_position)
		if distance <= explosion_radius:
			# Damage falloff based on distance
			var damage_multiplier = 1.0 - (distance / explosion_radius)
			var damage = explosion_damage * damage_multiplier
			if body.has_method(\"take_damage\"):
				body.take_damage(damage)
	
	# Spawn explosion effect
	spawn_explosion()
	queue_free()

func spawn_explosion():
	# Simple flash effect
	var flash = OmniLight3D.new()
	flash.light_color = Color(1, 0.6, 0.2)
	flash.light_energy = 5.0
	flash.omni_range = explosion_radius
	get_tree().root.add_child(flash)
	flash.global_position = global_position
	
	# Remove flash after short time
	var tween = flash.create_tween()
	tween.tween_property(flash, \"light_energy\", 0.0, 0.3)
	tween.tween_callback(flash.queue_free)
"

[sub_resource type="SphereShape3D" id="SphereShape3D_1"]
radius = 0.1

[sub_resource type="SphereMesh" id="SphereMesh_1"]
radius = 0.08
height = 0.16

[node name="Grenade" type="RigidBody3D" groups=["grenade"]]
mass = 0.5
script = SubResource("GDScript_1")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("SphereShape3D_1")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
mesh = SubResource("SphereMesh_1")
